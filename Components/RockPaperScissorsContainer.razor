<div class="text-center">
@if (currentRound.PlayerSelection == null)
{
    <div style="display:flex; place-content:center">
        <Card OnCardSelected=RoundEnd CardType="rock" />
        <Card OnCardSelected=RoundEnd CardType="paper"/>
        <Card OnCardSelected=RoundEnd CardType="scissors" />
    </div>
}
@if(currentRound.PlayerSelection != null)
{
        <div style="display:flex; place-content:center">
        <Card CardType="@currentRound.PlayerSelection.ToLower()" />
            <Card CardType="@currentRound.ComputerSelection.ToLower()" />
    </div>
}

<div>
    <input type="checkbox" @bind-value=enableLevelTwo /> Enable Level 2
</div>

<div>
    <h4>@message</h4>
    <h4>Wins: @winCount</h4>
</div>

<div>
    <button class="btn btn-primary" @onclick="ResetGame">Reset</button>
</div>
</div>
@code {
    private int winCount = 0;
    private string message = "Select a choice";
    private bool enableLevelTwo;
    private GameRound currentRound = new();
    List<GameRound> rounds = new();

    private void RoundEnd(string playerSelected)
    {
        currentRound.PlayerSelection = playerSelected;
        currentRound.ComputerSelection = GetComputerSelected();

        currentRound.Winner = CalculateWinner(currentRound);

        if(currentRound.Winner == 0)
        {
            message = "Tie";
        }
        else if(currentRound.Winner == 1)
        {
            message = "You Win";
            winCount++;
        }
        else if(currentRound.Winner == 2)
        {
            message = "You Lose";
            winCount = 0;
        }

        rounds.Add(currentRound);
    }

    private int CalculateWinner(GameRound gameRound)
    {
        string playerChoice = gameRound.PlayerSelection;
        string compChoice = gameRound.ComputerSelection;

        if (playerChoice == "rock")
        {
            if (compChoice == "rock")
            {
                return 0;
            }
            else if (compChoice == "paper")
            {
                return 2;
            }
            else if (compChoice == "scissors")
            {
                return 1;
            }
        }
        else if (playerChoice == "paper")
        {
            if (compChoice == "rock")
            {
                return 1;
            }
            else if (compChoice == "paper")
            {
                return 0;
            }
            else if (compChoice == "scissors")
            {
                return 2;
            }
        }
        else if (playerChoice == "scissors")
        {
            if (compChoice == "rock")
            {
                return 2;
            }
            else if (compChoice == "paper")
            {
                return 1;
            }
            else if (compChoice == "scissors")
            {
                return 0;
            }
        }

        return 0;
    }

    private string GetComputerSelected()
    {
        if (enableLevelTwo)
        {
            if (rounds.Count() > 1)
            {
                return(rounds[rounds.Count - 1].PlayerSelection);
            }
        }
        return RandomSelection();
    }

    private string RandomSelection(){
        Random rnd = new Random();
        int selected = rnd.Next(1, 4);
        return selected == 1 ? "rock" : selected == 2 ? "paper" : "scissors";
    }

    private void ResetGame()
    {
        currentRound = new();
        message = "Select a choice";
    }

    public class GameRound
    {
        public string PlayerSelection { get; set; }
        public string ComputerSelection { get; set; }
        public int Winner { get; set; }
    }
}
